description: >
  Run all tests in your project.

parameters:
  test-results-junit:
    description: >
      Path to write test results report using JUnit XML format.
    type: string
    default: ""

steps:
  - run:
      name: Run MATLAB tests
      command: |
        tmpdir=$(mktemp -d 2>/dev/null || mktemp -d -t 'run-tests')

        # download helper toolbox
        wget -q -O "${tmpdir}/ci_helpers.mltbx" https://github.com/mcafaro/ci-helpers/releases/download/v0.0.1/ci_helpers.mltbx

        # execute the MATLAB statement in batch mode
        matlab -batch "\
          matlab.addons.toolbox.installToolbox('${tmpdir}/ci_helpers.mltbx');\
          results = cihelpers.runTests('JUnitTestResults', '<<parameters.test-results-junit>>');\
          cihelpers.assertNoFailure(results);"
